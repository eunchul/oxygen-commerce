<div class="container_1box">

  <div class="container_header">
  </div><!-- container_header -->

  <div class="unit_content">

    <div class="section">

      <%= form_tag "/admin/reservations", :method => :get do %>
        <div class="search_filter">
          <div class="left">기간:</div>
          <div class="right">
            <%= calendar_date_select_tag "starts_at", params[:starts_at], :size => 10 %>
            ~
            <%= calendar_date_select_tag "ends_at", params[:ends_at], :size => 10 %>
          </div>
        </div>

        <div class="search_filter">
          <div class="left">그룹:</div>
          <div class="right">
            <ul>
              <li><%= radio_button_tag "groupby", "used_at", (params[:groupby] == "used_at" || params[:groupby].nil? ? true : false) %>이용일</li>
              <li><%= radio_button_tag "groupby", "agency", (params[:groupby] == "agency" ? true : false) %>판매업체</li>
            </ul>
          </div>
        </div>

        <div class="search_filter">
          <div class="left">스키장:</div>
          <div class="right">
            <ul>
              <% RESORT_OPTIONS.each do |value, text| %>
                <li><%= check_box_tag "resort[]", value, ((params[:resort] && params[:resort].include?(value)) ? true : false) %><%= text %></li>
              <% end %>
            </ul>
          </div>
        </div>

        <div class="search_filter">
          <div class="left">사용자명:</div>
          <div class="right">
            <%= text_field_tag "user_name", params[:user_name], :size => 14 %></li>
          </div>
        </div>

        <div class="search_filter">
          <div class="left">쿠폰번호:</div>
          <div class="right">
            <%= text_field_tag "coupon_number", params[:coupon_number] %></li>
          </div>
        </div>

        <%= submit_tag "조회" %>
      <% end %>


      <ul class="filters">
        <li><%= link_to "이용일별", "?groupby=used_at" %></li>
        <li class="spacer">|</li>
        <li><%= link_to "구매업체별", "?groupby=agency" %></li>
        <li class="spacer">|</li>
        <li><%= link_to "판매업체별", "?groupby=provider" %></li>
      </ul>
    </div>

    <% @grouped_reservations.each do |key, reservations| %>

      <div class="section">
        <h4><%= display_group_by_string(params[:groupby], key) %></h4>

        <table class="reservations_with_orders">
          <thead>
            <tr>
              <th class="subscriber_name">예약자</th>
              <th class="coupon_number">쿠폰번호</th>
              <th class="resort">스키장</th>
              <th class="used_at">이용일</th>
              <th class="part_time">시간대</th>
              <th class="user_name">사용자명</th>
              <th class="shoe_type">장비구분</th>
              <th class="board_stance">장비옵션</th>
              <th class="height">신장</th>
              <th class="shoe_size">신발크기</th>
              <th class="actions"></th>
            </tr>
          </thead>
          <tbody>
            <% reservations.each do |reservation| %>
              <% reservation.orders.each do |order| %>
                <%= render "admin/reservations/tr_reservation_with_order", :reservation => reservation, :order => order %>
              <% end %>
            <% end %>
          </tbody>
        </table>

      </div>

    <% end %>

  </div><!-- unit_content -->

</div><!-- container_1box -->
